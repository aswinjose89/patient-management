{"version":3,"sources":["ng://angular-fhir/lib/pipes/age.pipe.ts","ng://angular-fhir/lib/pipes/fhir-coding.pipe.ts","ng://angular-fhir/lib/pipes/fhir-usual-name.pipe.ts","ng://angular-fhir/lib/utils/format.ts","ng://angular-fhir/lib/pipes/observation-value.pipe.ts","node_modules/tslib/tslib.es6.js","ng://angular-fhir/lib/services/regional.service.ts","ng://angular-fhir/lib/services/fhir.service.ts","ng://angular-fhir/lib/loader/loader.component.ts","ng://angular-fhir/lib/services/loader.service.ts","ng://angular-fhir/lib/angular-fhir.module.ts"],"names":["AgePipe","prototype","transform","value","args","moment","isValid","diff","Pipe","name","FhirCodingPipe","code","coding","length","display","FhirUsualNamePipe","formatFhirName","noTitle","capitaliseLastName","firstNameFirst","preferredName","reduce","best","idx","names","use","text","family","toUpperCase","titles","prefix","join","given","ObservationValuePipe","observation","multi","component","map","toValueString","item","unit","valueString","valueReference","valueCoding","valueUri","valueBoolean","valueAddress","valueAge","valueAnnotation","valueAttachment","valueBase64Binary","valueCode","valueCodeableConcept","valueContactPoint","valueCount","valueDate","valueDecimal","valueDuration","valueHumanName","valueId","valueDateTime","valueDistance","valueInteger","valueQuantity","__generator","thisArg","body","f","y","t","g","_","label","sent","trys","ops","next","verb","throw","return","Symbol","iterator","this","n","v","step","op","TypeError","call","done","pop","push","e","RegionalConfigService","load","region","__awaiter","_arguments","P","generator","Promise","resolve","reject","fulfilled","rejected","result","then","apply","fetch","_a","json","config","Object","keys","forEach","key","defineProperty","_this","get","Injectable","FhirService","hasCoding","concept","codes","find","ia","system","_b","__values","o","m","i","tslib_1.__values","_c","referenceToId","reference","__read","r","ar","error","split","resourceType","id","flattenExtension","extension","obj","ext","url","getUrl","tenancyOverride","base","tenancy","setUrl","newUrl","options","HttpHeaders","Accept","nextPage","response","nextLink","link","l","relation","http","throwError","Error","ref","context","absoluteUri","referenceToAbsoluteUrl","ref$","refCache","startsWith","ReplaySubject","subscribe","set","of","search","params","requestOptions","headers","patch","resourceUrl","cmd","content-type","assign","delete","save","bundle","post","Prefer","pipe","tap","bundleResponse","entry","k","resource","saveAll","resources","bundleEntries","p","request","method","type","resolveReferences","references","count","Array","isArray","ids","getContextBaseUrl","Content-Type","expand","res","foundNext","url.format","url.parse","acc","concat","refUrl","hash","protocol","url.resolve","meta","security","tenancyTag","sec","IDENTIFIER_SYSTEMS","TENANCY_SECURITY_SYSTEM","EXTENSIONS","TASK_ENABLE_WHEN","EDUCATION_TASK","ADHERENCE","RECURRING_TASK","BASED_ON_GOAL","PATIENT_SPECIFIC_REMINDER","ORGANIZATION_ATTRIBUTES","SITECODE","FHIR_IDENTIFIER_TYPE","SNOMED","GOAL_CATEGORY","HttpClient","LRUMap","CONTAINER_DATA","InjectionToken","LoaderComponent","Component","selector","template","Optional","Inject","componentData","message","LoaderService","start","overlayRef","overlay","create","overlayConfig","containerPortal","ComponentPortal","createInjector","attach","stop","dispose","dataToPass","injectorTokens","WeakMap","PortalInjector","injector","Overlay","Injector","OverlayConfig","positionStrategy","position","global","centerHorizontally","centerVertically","hasBackdrop","AngularFhirModule","NgModule","declarations","imports","CommonModule","exports","providers"],"mappings":"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","sourcesContent":["import { Pipe, PipeTransform } from '@angular/core';\nimport moment from 'moment';\n\n@Pipe({\n  name: 'ageInYears'\n})\nexport class AgePipe implements PipeTransform {\n\n  transform(value: any, args?: any): any {\n    if (!value || !moment(value).isValid()) { return void 0; }\n    return moment().diff(value, 'years');\n  }\n\n}\n","import { Pipe, PipeTransform } from '@angular/core';\n\n@Pipe({\n  name: 'fhirCoding'\n})\nexport class FhirCodingPipe implements PipeTransform {\n\n  transform(value: {code: fhir.CodeableConcept}, args?: any): any {\n    if (value && value.code && value.code.coding && value.code.coding.length > 0) {\n      return value.code.coding[0].display;\n    }\n    return '';\n  }\n\n}\n","import { Pipe, PipeTransform } from '@angular/core';\nimport { formatFhirName } from '../utils/format';\n\n@Pipe({\n  name: 'fhirUsualName'\n})\nexport class FhirUsualNamePipe implements PipeTransform {\n\n  transform(value: fhir.HumanName[], args?: any): any {\n    return formatFhirName(value, args);\n  }\n\n}\n","import moment from 'moment';\n\ninterface INameFormatArgs {\n  noTitle?: boolean;\n  capitaliseLastName?: boolean;\n  firstNameFirst?: boolean;\n}\n\nexport function formatAddress(organisation: fhir.Organization, types?: string[]): string {\n  if (!organisation || !organisation.address ||\n    !Array.isArray(organisation.address) || !organisation.address.length) {\n    return '';\n  }\n\n  types = types || [];\n  let address = organisation.address.find(item => types.indexOf(item.type) > -1);\n  address = address || organisation.address[0];\n\n  const phoneNumber = organisation.telecom.find(item => item.system === 'phone');\n\n  return [\n    `${organisation.name},`,\n    `${address.line.join(' ')},`,\n    address.city,\n    address.state,\n    address.postalCode,\n    phoneNumber\n  ].join(' ');\n}\n\nexport function toValueString(item) {\n  // A hack for pluralising some unit names\n  const formatUnit = (unit, value) => {\n    if (value !== 1) {\n      if (unit === 'serving') {\n        return `${unit}s`;\n      }\n    }\n    return unit;\n  };\n\n  return item.valueString ? item.valueString :\n    item.valueReference ? item.valueReference :\n    item.valueCoding ? item.valueCoding :\n    item.valueUri ? item.valueUri :\n    item.valueBoolean ? item.valueBoolean :\n    item.valueAddress ? item.valueAddress :\n    item.valueAge ? item.valueAge :\n    item.valueAnnotation ? item.valueAnnotation :\n    item.valueAttachment ? item.valueAttachment :\n    item.valueBase64Binary ? item.valueBase64Binary :\n    item.valueCode ? item.valueCode :\n    item.valueCodeableConcept ? item.valueCodeableConcept :\n    item.valueContactPoint ? item.valueContactPoint :\n    item.valueCount ? item.valueCount :\n    item.valueDate ? item.valueDate :\n    item.valueDecimal ? item.valueDecimal :\n    item.valueDuration ? item.valueDuration :\n    item.valueHumanName ? item.valueHumanName :\n    item.valueId ? item.valueId :\n    item.valueDateTime ? item.valueDateTime :\n    item.valueDistance ? item.valueDistance :\n    item.valueInteger ? item.valueInteger :\n    // todo add additional value[x] types\n    item.valueQuantity ? `${item.valueQuantity.value} ${formatUnit(item.valueQuantity.unit, item.valueQuantity.value)}` : '';\n}\n\n// tslint:disable-next-line:max-line-length\nexport function formatFhirName(value: fhir.HumanName[], args: INameFormatArgs = {noTitle: false, capitaliseLastName: false, firstNameFirst: false}) {\n  if (value && value.length > 0) {\n    const preferredName = value.reduce((best, name, idx, names) => {\n      if (name.use === 'usual') {\n        return name;\n      } else if (!best) {\n        return name;\n      } else {\n        if (name.use === 'official') {\n          return name;\n        }\n      }\n      return best;\n    });\n    if (preferredName.text) {\n      return preferredName.text;\n    }\n\n    const family = (args.capitaliseLastName ? preferredName.family.toUpperCase() : preferredName.family) || '';\n    const titles = (preferredName.prefix || []).length > 0 ? ` (${(preferredName.prefix || []).join(' ')})` : '';\n    // tslint:disable-next-line:max-line-length\n    return args.firstNameFirst ? `${args.noTitle ? '' : titles} ${(preferredName.given || [])[0]} ${family}` : `${family}, ${(preferredName.given || [])[0]}${args.noTitle ? '' : titles}`;\n  } else {\n    return '<No Name>';\n  }\n}\n\nexport function formatDOB(date: string, includeAge: boolean = false) {\n  const mDate = moment(date);\n  const age = ` (${moment().diff(mDate, 'years')} ys)`;\n  return `${mDate.format('DD-MMM-YYYY')}${includeAge ? age : ''}`;\n}\n\n","import { Pipe, PipeTransform } from '@angular/core';\nimport { FhirCodingPipe } from './fhir-coding.pipe';\nimport { toValueString } from '../utils';\n\n@Pipe({\n  name: 'observationValue'\n})\nexport class ObservationValuePipe implements PipeTransform {\n  constructor() {}\n\n  transform(observation: fhir.Observation, args?: any): any {\n    const multi = (observation.component || []).length > 1;\n    return (observation.component || [])\n    .map(component => {\n      return `${multi ? new FhirCodingPipe().transform(component) + ':' : ''}${toValueString(component)}`;\n    }).join(', ');\n  }\n}\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)\r\n            t[p[i]] = s[p[i]];\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\r\n    if (m) return m.call(o);\r\n    return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n","import { Injectable } from '@angular/core';\n\nexport interface AnyConfig {\n    [key: string]: any;\n}\n\n@Injectable()\nexport class RegionalConfigService implements AnyConfig {\n\n  async load(region): Promise<any> {\n    // assert that region is one of ['au', 'de', 'us']\n\n    const configResponse = await fetch(`./assets/environment-${region}.json`);\n    const config: any = await configResponse.json();\n\n    Object.keys(config).forEach(key => {\n      Object.defineProperty(this, key, {\n        get: () => config[key]\n      });\n    });\n    return config;\n  }\n\n  get(key) {\n    return this[key];\n  }\n}\n\n","import { Injectable } from '@angular/core';\nimport { HttpHeaders, HttpClient } from '@angular/common/http';\nimport { Observable, throwError, ReplaySubject, of } from 'rxjs';\nimport { map, tap, expand, reduce } from 'rxjs/operators';\nimport { LRUMap } from 'lru_map';\nimport * as url from 'url';\nimport { RegionalConfigService } from './regional.service';\n\nexport interface IFhirResponse<T extends fhir.Resource> {\n  resourceType: string;\n  id: string;\n  meta: {\n    lastUpdated: string;\n  };\n  type: string;\n  total: number;\n  link: {\n    relation: string,\n    url: string;\n  }[];\n  entry: {\n    fullUrl: string;\n    resource: T;\n    search: {\n      mode: string;\n    };\n  }[];\n}\n\nexport interface IFhirSearchParams {\n  nextUrl?: string;\n  _count?: string;\n  _sort?: string;\n  _getpagesoffset?: string;\n  [param: string]: string | string[];\n}\n\n@Injectable()\nexport class FhirService {\n\n  static EXTENSIONS = {\n    TASK_ENABLE_WHEN: 'https://fhir-registry.cardihab.com/StructureDefiniton/TaskEnableWhen',\n    EDUCATION_TASK: 'https://fhir-registry.cardihab.com/StructureDefiniton/EducationTask',\n    ADHERENCE: 'https://fhir-registry.cardihab.com/StructureDefiniton/Adherence',\n    RECURRING_TASK: 'https://fhir-registry.cardihab.com/StructureDefiniton/RecurringTask',\n    BASED_ON_GOAL: 'https://fhir-registry.cardihab.com/StructureDefiniton/BasedOnGoal',\n    PATIENT_SPECIFIC_REMINDER: 'https://fhir-registry.cardihab.com/StructureDefiniton/PatientSpecificReminder',\n    ORGANIZATION_ATTRIBUTES: 'https://fhir-registry.cardihab.com/StructureDefiniton/OrganizationAttributes'\n  };\n\n  static IDENTIFIER_SYSTEMS = {\n    SITECODE: 'urn:sitecode',\n    FHIR_IDENTIFIER_TYPE: 'http://hl7.org/fhir/identifier-type',\n    SNOMED: 'http://snomed.info/sct',\n    GOAL_CATEGORY: 'http://hl7.org/fhir/goal-category',\n    TENANCY_SECURITY_SYSTEM: 'Tenancy'\n  };\n\n\n  // set by auth guard. Fixme cleaner separation would be nice\n  public base = this.config.get('fhir');\n  public tenancy = 'baseDstu3';\n\n  private refCache = new LRUMap<string, any>(100);\n\n  static hasCoding(concept: fhir.CodeableConcept, codes) {\n    if (concept && concept.coding && codes) {\n      for (const code of concept.coding) {\n        if (code.code && codes.find(ia => ia.system === code.system && ia.code === code.code) != null) {\n          return true;\n        }\n      }\n    }\n    return false;\n  }\n\n  static referenceToId(reference: fhir.Reference): { resourceType: string, id: string } {\n    const [resourceType, id] = (reference || { reference: '' }).reference.split('/');\n    return {\n      resourceType,\n      id\n    };\n  }\n\n  static flattenExtension<T>(extension: fhir.Extension): T | any {\n    const obj = {};\n    if (extension.extension) {\n      extension.extension.forEach(ext => {\n        obj[ext.url] = FhirService.flattenExtension(ext);\n      });\n    } else {\n      return extension.valueString ? extension.valueString :\n        extension.valueReference ? extension.valueReference :\n          extension.valueCoding ? extension.valueCoding :\n            extension.valueUri ? extension.valueUri :\n              extension.valueBoolean ? extension.valueBoolean :\n                extension.valueAddress ? extension.valueAddress :\n                  extension.valueAge ? extension.valueAge :\n                    extension.valueAnnotation ? extension.valueAnnotation :\n                      extension.valueAttachment ? extension.valueAttachment :\n                        extension.valueBase64Binary ? extension.valueBase64Binary :\n                          extension.valueCode ? extension.valueCode :\n                            extension.valueCodeableConcept ? extension.valueCodeableConcept :\n                              extension.valueContactPoint ? extension.valueContactPoint :\n                                extension.valueCount ? extension.valueCount :\n                                  extension.valueDate ? extension.valueDate :\n                                    extension.valueDecimal ? extension.valueDecimal :\n                                      extension.valueDuration ? extension.valueDuration :\n                                        extension.valueHumanName ? extension.valueHumanName :\n                                          extension.valueId ? extension.valueId :\n                                            extension.valueDateTime ? extension.valueDateTime :\n                                              extension.valueDistance ? extension.valueDistance :\n                                                extension.valueInteger ? extension.valueInteger :\n                                                  // todo add additional value[x] types\n                                                  null;\n    }\n    return obj;\n  }\n\n  constructor(private http: HttpClient, private config: RegionalConfigService) { }\n\n  getUrl(tenancyOverride?: string): string {\n    return `${this.base}/${tenancyOverride ? tenancyOverride : this.tenancy}`;\n  }\n\n  setUrl(newUrl: string) {\n    this.base = newUrl;\n  }\n\n  options(): HttpHeaders {\n    return new HttpHeaders({ Accept: 'application/json' });\n  }\n\n  nextPage<T>(response: IFhirResponse<T>): Observable<IFhirResponse<T>> {\n    if (response) {\n      const nextLink = (response.link || []).find(l => l.relation === 'next');\n      if (nextLink) {\n        return this.http.get<IFhirResponse<T>>(nextLink.url);\n      }\n    }\n\n    return throwError(new Error('No next link to follow'));\n  }\n\n  reference<T>(ref: fhir.Reference, context: fhir.DomainResource): Observable<T> {\n    if (ref && ref.reference) {\n      const absoluteUri = this.referenceToAbsoluteUrl(ref, context);\n      let ref$ = this.refCache.get(absoluteUri);\n\n      // TODO handle contained resource references\n      if (absoluteUri.startsWith('#')) {\n        return throwError(new Error(`Don't yet support contained references`));\n\n      } else {\n        if (!ref$) {\n          ref$ = new ReplaySubject<T>(1);\n          this.http.get<T>(absoluteUri)\n            .subscribe(ref$);\n          this.refCache.set(absoluteUri, ref$);\n        }\n        return ref$;\n      }\n    } else {\n      return throwError(new Error('Invalid reference'));\n    }\n  }\n\n  get<T extends fhir.Resource>(resourceType: string, id: string, tenancy?: string): Observable<T> {\n    if (id === 'new') {\n      return of(null);\n    } else {\n      return this.http.get<T>(`${this.getUrl(tenancy)}/${resourceType}/${id}`);\n    }\n  }\n\n  search<T extends fhir.Resource>(\n    resourceType: string,\n    params: any,\n    options?: { tenancy?: string, headers?: any }\n  ): Observable<IFhirResponse<T>> {\n    const requestOptions: { params: any, headers?: any } = { params };\n    if (options && options.headers) {\n      requestOptions.headers = options.headers;\n    }\n    return this.http.get<IFhirResponse<T>>(`${this.getUrl((options || {}).tenancy)}/${resourceType}`, requestOptions);\n  }\n\n  patch(resourceUrl, cmd, options?: { tenancy?: string, headers?: any }): Observable<any> {\n    const requestOptions: { params?: any, headers?: any } = {\n      headers: {\n        'content-type': 'application/json-patch+json'\n      }\n    };\n    if (options && options.headers) {\n      Object.assign(requestOptions.headers, options.headers);\n    }\n    return this.http.patch(resourceUrl, cmd, requestOptions);\n  }\n\n  delete(resourceType, id, options?: {tenancy?: string, headers?: any}) {\n    const requestOptions: { params?: any, headers?: any } = { };\n    if (options && options.headers) {\n      requestOptions.headers = options.headers;\n    }\n    return this.http.delete(`${this.getUrl((options || {}).tenancy)}/${resourceType}/${id}`, requestOptions);\n  }\n\n  save<T extends fhir.Resource>(bundle: T, options?: { tenancy?: string, headers?: any }): Observable<T> {\n    if (bundle.resourceType === 'Bundle') {\n      return this.http.post<T>(`${this.getUrl((options || {}).tenancy)}`, bundle, {\n        headers: {\n          'content-type': 'application/fhir+json',\n          Prefer: 'return=representation'\n        }\n      }).pipe(\n        tap(bundleResponse => {\n          ((bundleResponse as fhir.Bundle).entry || []).forEach((v: fhir.BundleEntry, k) => {\n            if ((bundle as fhir.Bundle).entry[k]) {\n              (bundle as fhir.Bundle).entry[k].resource.id = v.resource.id;\n            }\n          });\n        })\n      );\n    } else {\n      return this.saveAll([bundle], options)\n        .pipe(\n          map(bundleResponse => bundleResponse.entry[0].resource as T)\n        );\n    }\n  }\n\n  saveAll(resources: fhir.Resource[], options?: { tenancy?: string, headers?: any }): Observable<fhir.Bundle> {\n\n    const bundleEntries = resources.map(p => {\n      return {\n        request: {\n          method: p.id ? 'PUT' : 'POST',\n          // tslint:disable-next-line:no-string-literal\n          url: p.id ? `${p.resourceType}/${p.id}` : (p['identifier'] || [])[0] ? `urn:uuid:${p['identifier'][0].value}` : p.resourceType\n        },\n        resource: p\n      };\n    });\n\n    return this.save<fhir.Bundle>({\n      resourceType: 'Bundle',\n      type: 'transaction',\n      entry: bundleEntries\n    }, options);\n  }\n\n  resolveReferences<T extends fhir.DomainResource>(\n    references: fhir.Reference[],\n    context: fhir.DomainResource,\n    count: number = 500\n  ): Observable<fhir.Bundle> {\n    if (!references || !Array.isArray(references) || !references.length) {\n      return of({} as fhir.Bundle);\n    }\n\n    const { resourceType } = FhirService.referenceToId(references[0]);\n    const ids = references.map(ref => FhirService.referenceToId(ref).id);\n\n    return this.http.post<IFhirResponse<T>>(`${this.getContextBaseUrl(context)}/${resourceType}/_search`,\n      `_id=${ids.join(',')}&_count=${count}`,\n      {\n        headers: {\n          'Content-Type': 'application/x-www-form-urlencoded'\n        }\n      })\n      .pipe(\n        expand((res) => {\n          const foundNext = (res.link.find(l => l.relation === 'next') || {} as any).url;\n          if (foundNext) {\n            return this.http.get<IFhirResponse<fhir.Bundle>>(url.format(url.parse(foundNext, true)));\n          }\n          return of();\n        }),\n        reduce((acc: fhir.Bundle, value: fhir.Bundle) => {\n          if (acc.entry && value.entry) {\n            acc.entry = acc.entry.concat(value.entry);\n          }\n          return acc;\n        })\n      );\n  }\n\n  referenceToAbsoluteUrl(ref: fhir.Reference, context: fhir.Resource): string {\n    const refUrl = url.parse(ref.reference);\n    if (refUrl.hash && !refUrl.protocol) { // don't touch contained resource references\n      return ref.reference;\n    }\n    const base = this.getContextBaseUrl(context);\n    return url.resolve(`${base}/`, ref.reference);\n  }\n\n  getContextBaseUrl(context?: fhir.Resource) {\n    let base = this.getUrl();\n    if (context && context.meta && context.meta.security) {\n      const tenancyTag = context.meta.security.find(sec => sec.system === FhirService.IDENTIFIER_SYSTEMS.TENANCY_SECURITY_SYSTEM);\n      if (tenancyTag) {\n        base = this.getUrl(tenancyTag.display);\n      }\n    }\n    return base;\n  }\n}\n","import { Component, Inject, Optional, InjectionToken } from '@angular/core';\n\nexport const CONTAINER_DATA = new InjectionToken<any>('CONTAINER_DATA');\n@Component({\n  selector: 'lib-loader',\n  templateUrl: './loader.component.html',\n  styleUrls: ['./loader.component.scss']\n})\nexport class LoaderComponent {\n\n  message: string;\n\n  constructor(@Optional() @Inject(CONTAINER_DATA) private componentData: any) {\n    this.message = this.componentData && this.componentData.message\n      ? this.componentData.message : '';\n  }\n\n}\n","import { Injectable, Injector } from '@angular/core';\nimport { Overlay, OverlayConfig, OverlayRef } from '@angular/cdk/overlay';\nimport { ComponentPortal, PortalInjector } from '@angular/cdk/portal';\nimport { LoaderComponent, CONTAINER_DATA } from '../loader/loader.component';\n\n@Injectable()\nexport class LoaderService {\n\n  overlayRef: OverlayRef;\n  overlayConfig: OverlayConfig = new OverlayConfig();\n\n  constructor(private overlay: Overlay, private injector: Injector) {\n    this.overlayConfig.positionStrategy = this.overlay.position()\n      .global()\n      .centerHorizontally()\n      .centerVertically();\n    this.overlayConfig.hasBackdrop = true;\n  }\n\n  start(message: string = '') {\n    this.overlayRef = this.overlay.create(this.overlayConfig);\n    const containerPortal = new ComponentPortal(LoaderComponent, null, this.createInjector({\n      message\n    }));\n    this.overlayRef.attach(containerPortal);\n  }\n\n  stop() {\n    this.overlayRef.dispose();\n  }\n\n  private createInjector(dataToPass: {}): PortalInjector {\n    const injectorTokens = new WeakMap();\n    injectorTokens.set(CONTAINER_DATA, dataToPass);\n    return new PortalInjector(this.injector, injectorTokens);\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { FhirCodingPipe, FhirUsualNamePipe, ObservationValuePipe, AgePipe } from './pipes';\nimport { FhirService } from './services/fhir.service';\nimport { RegionalConfigService } from './services/regional.service';\nimport { LoaderComponent } from './loader/loader.component';\nimport { LoaderService } from './services/loader.service';\nimport { CommonModule } from '@angular/common';\n\n@NgModule({\n  declarations: [\n    FhirCodingPipe,\n    FhirUsualNamePipe,\n    AgePipe,\n    ObservationValuePipe,\n    LoaderComponent\n  ],\n  imports: [\n    CommonModule\n  ],\n  exports: [\n    FhirCodingPipe,\n    FhirUsualNamePipe,\n  ],\n  providers: [\n    FhirService,\n    RegionalConfigService,\n    LoaderService\n  ]\n})\nexport class AngularFhirModule { }\n"]}