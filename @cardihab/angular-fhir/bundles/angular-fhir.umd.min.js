!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("moment"),require("@angular/common/http"),require("rxjs"),require("rxjs/operators"),require("lru_map"),require("url"),require("@angular/core"),require("@angular/cdk/overlay"),require("@angular/cdk/portal"),require("@angular/common")):"function"==typeof define&&define.amd?define("angular-fhir",["exports","moment","@angular/common/http","rxjs","rxjs/operators","lru_map","url","@angular/core","@angular/cdk/overlay","@angular/cdk/portal","@angular/common"],t):t(e["angular-fhir"]={},e.moment,e.ng.common.http,e.rxjs,e.rxjs.operators,e.lru_map,e.url,e.ng.core,e.ng.cdk.overlay,e.ng.cdk.portal,e.ng.common)}(this,function(e,r,t,i,u,n,l,a,o,s,c){"use strict";r=r&&r.hasOwnProperty("default")?r["default"]:r;var f=(p.prototype.transform=function(e,t){if(e&&r(e).isValid())return r().diff(e,"years")},p.decorators=[{type:a.Pipe,args:[{name:"ageInYears"}]}],p);function p(){}var v=(h.prototype.transform=function(e,t){return e&&e.code&&e.code.coding&&0<e.code.coding.length?e.code.coding[0].display:""},h.decorators=[{type:a.Pipe,args:[{name:"fhirCoding"}]}],h);function h(){}var d=(y.prototype.transform=function(e,t){return function o(e,t){if(void 0===t&&(t={noTitle:!1,capitaliseLastName:!1,firstNameFirst:!1}),e&&0<e.length){var r=e.reduce(function(e,t,r,n){return"usual"===t.use?t:e?"official"===t.use?t:e:t});if(r.text)return r.text;var n=(t.capitaliseLastName?r.family.toUpperCase():r.family)||"",a=0<(r.prefix||[]).length?" ("+(r.prefix||[]).join(" ")+")":"";return t.firstNameFirst?(t.noTitle?"":a)+" "+(r.given||[])[0]+" "+n:n+", "+(r.given||[])[0]+(t.noTitle?"":a)}return"<No Name>"}(e,t)},y.decorators=[{type:a.Pipe,args:[{name:"fhirUsualName"}]}],y);function y(){}var g=(m.prototype.transform=function(e,t){var n=1<(e.component||[]).length;return(e.component||[]).map(function(e){return(n?(new v).transform(e)+":":"")+function r(e){var t;return e.valueString?e.valueString:e.valueReference?e.valueReference:e.valueCoding?e.valueCoding:e.valueUri?e.valueUri:e.valueBoolean?e.valueBoolean:e.valueAddress?e.valueAddress:e.valueAge?e.valueAge:e.valueAnnotation?e.valueAnnotation:e.valueAttachment?e.valueAttachment:e.valueBase64Binary?e.valueBase64Binary:e.valueCode?e.valueCode:e.valueCodeableConcept?e.valueCodeableConcept:e.valueContactPoint?e.valueContactPoint:e.valueCount?e.valueCount:e.valueDate?e.valueDate:e.valueDecimal?e.valueDecimal:e.valueDuration?e.valueDuration:e.valueHumanName?e.valueHumanName:e.valueId?e.valueId:e.valueDateTime?e.valueDateTime:e.valueDistance?e.valueDistance:e.valueInteger?e.valueInteger:e.valueQuantity?e.valueQuantity.value+" "+(t=e.valueQuantity.unit,1!==e.valueQuantity.value&&"serving"===t?t+"s":t):""}(e)}).join(", ")},m.decorators=[{type:a.Pipe,args:[{name:"observationValue"}]}],m.ctorParameters=function(){return[]},m);function m(){}function C(n,a){var o,i,u,e,l={label:0,sent:function(){if(1&u[0])throw u[1];return u[1]},trys:[],ops:[]};return e={next:t(0),"throw":t(1),"return":t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function r(e){if(o)throw new TypeError("Generator is already executing.");for(;l;)try{if(o=1,i&&(u=2&e[0]?i["return"]:e[0]?i["throw"]||((u=i["return"])&&u.call(i),0):i.next)&&!(u=u.call(i,e[1])).done)return u;switch(i=0,u&&(e=[2&e[0],u.value]),e[0]){case 0:case 1:u=e;break;case 4:return l.label++,{value:e[1],done:!1};case 5:l.label++,i=e[1],e=[0];continue;case 7:e=l.ops.pop(),l.trys.pop();continue;default:if(!(u=0<(u=l.trys).length&&u[u.length-1])&&(6===e[0]||2===e[0])){l=0;continue}if(3===e[0]&&(!u||e[1]>u[0]&&e[1]<u[3])){l.label=e[1];break}if(6===e[0]&&l.label<u[1]){l.label=u[1],u=e;break}if(u&&l.label<u[2]){l.label=u[2],l.ops.push(e);break}u[2]&&l.ops.pop(),l.trys.pop();continue}e=a.call(n,l)}catch(t){e=[6,t],i=0}finally{o=u=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([t,e])}}}var b=(T.prototype.load=function(n){return function e(t,i,u,l){return new(u||(u=Promise))(function(e,r){function n(e){try{o(l.next(e))}catch(t){r(t)}}function a(e){try{o(l["throw"](e))}catch(t){r(t)}}function o(t){t.done?e(t.value):new u(function(e){e(t.value)}).then(n,a)}o((l=l.apply(t,i||[])).next())})}(this,void 0,void 0,function(){var t,r=this;return C(this,function(e){switch(e.label){case 0:return[4,fetch("./assets/environment-"+n+".json")];case 1:return[4,e.sent().json()];case 2:return t=e.sent(),Object.keys(t).forEach(function(e){Object.defineProperty(r,e,{get:function(){return t[e]}})}),[2,t]}})})},T.prototype.get=function(e){return this[e]},T.decorators=[{type:a.Injectable}],T);function T(){}var E=(A.hasCoding=function(e,r){var t,n;if(e&&e.coding&&r){var a=function(t){if(t.code&&null!=r.find(function(e){return e.system===t.system&&e.code===t.code}))return{value:!0}};try{for(var o=function l(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}}(e.coding),i=o.next();!i.done;i=o.next()){var u=a(i.value);if("object"==typeof u)return u.value}}catch(s){t={error:s}}finally{try{i&&!i.done&&(n=o["return"])&&n.call(o)}finally{if(t)throw t.error}}}return!1},A.referenceToId=function(e){var t=function l(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,a,o=r.call(e),i=[];try{for(;(void 0===t||0<t--)&&!(n=o.next()).done;)i.push(n.value)}catch(u){a={error:u}}finally{try{n&&!n.done&&(r=o["return"])&&r.call(o)}finally{if(a)throw a.error}}return i}((e||{reference:""}).reference.split("/"),2);return{resourceType:t[0],id:t[1]}},A.flattenExtension=function(e){var t={};return e.extension?(e.extension.forEach(function(e){t[e.url]=A.flattenExtension(e)}),t):e.valueString?e.valueString:e.valueReference?e.valueReference:e.valueCoding?e.valueCoding:e.valueUri?e.valueUri:e.valueBoolean?e.valueBoolean:e.valueAddress?e.valueAddress:e.valueAge?e.valueAge:e.valueAnnotation?e.valueAnnotation:e.valueAttachment?e.valueAttachment:e.valueBase64Binary?e.valueBase64Binary:e.valueCode?e.valueCode:e.valueCodeableConcept?e.valueCodeableConcept:e.valueContactPoint?e.valueContactPoint:e.valueCount?e.valueCount:e.valueDate?e.valueDate:e.valueDecimal?e.valueDecimal:e.valueDuration?e.valueDuration:e.valueHumanName?e.valueHumanName:e.valueId?e.valueId:e.valueDateTime?e.valueDateTime:e.valueDistance?e.valueDistance:e.valueInteger?e.valueInteger:null},A.prototype.getUrl=function(e){return this.base+"/"+(e||this.tenancy)},A.prototype.setUrl=function(e){this.base=e},A.prototype.options=function(){return new t.HttpHeaders({Accept:"application/json"})},A.prototype.nextPage=function(e){if(e){var t=(e.link||[]).find(function(e){return"next"===e.relation});if(t)return this.http.get(t.url)}return i.throwError(new Error("No next link to follow"))},A.prototype.reference=function(e,t){if(e&&e.reference){var r=this.referenceToAbsoluteUrl(e,t),n=this.refCache.get(r);return r.startsWith("#")?i.throwError(new Error("Don't yet support contained references")):(n||(n=new i.ReplaySubject(1),this.http.get(r).subscribe(n),this.refCache.set(r,n)),n)}return i.throwError(new Error("Invalid reference"))},A.prototype.get=function(e,t,r){return"new"===t?i.of(null):this.http.get(this.getUrl(r)+"/"+e+"/"+t)},A.prototype.search=function(e,t,r){var n={params:t};return r&&r.headers&&(n.headers=r.headers),this.http.get(this.getUrl((r||{}).tenancy)+"/"+e,n)},A.prototype.patch=function(e,t,r){var n={headers:{"content-type":"application/json-patch+json"}};return r&&r.headers&&Object.assign(n.headers,r.headers),this.http.patch(e,t,n)},A.prototype["delete"]=function(e,t,r){var n={};return r&&r.headers&&(n.headers=r.headers),this.http["delete"](this.getUrl((r||{}).tenancy)+"/"+e+"/"+t,n)},A.prototype.save=function(r,e){return"Bundle"===r.resourceType?this.http.post(""+this.getUrl((e||{}).tenancy),r,{headers:{"content-type":"application/fhir+json",Prefer:"return=representation"}}).pipe(u.tap(function(e){(e.entry||[]).forEach(function(e,t){r.entry[t]&&(r.entry[t].resource.id=e.resource.id)})})):this.saveAll([r],e).pipe(u.map(function(e){return e.entry[0].resource}))},A.prototype.saveAll=function(e,t){var r=e.map(function(e){return{request:{method:e.id?"PUT":"POST",url:e.id?e.resourceType+"/"+e.id:(e.identifier||[])[0]?"urn:uuid:"+e.identifier[0].value:e.resourceType},resource:e}});return this.save({resourceType:"Bundle",type:"transaction",entry:r},t)},A.prototype.resolveReferences=function(e,t,r){var n=this;if(void 0===r&&(r=500),!e||!Array.isArray(e)||!e.length)return i.of({});var a=A.referenceToId(e[0]).resourceType,o=e.map(function(e){return A.referenceToId(e).id});return this.http.post(this.getContextBaseUrl(t)+"/"+a+"/_search","_id="+o.join(",")+"&_count="+r,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).pipe(u.expand(function(e){var t=(e.link.find(function(e){return"next"===e.relation})||{}).url;return t?n.http.get(l.format(l.parse(t,!0))):i.of()}),u.reduce(function(e,t){return e.entry&&t.entry&&(e.entry=e.entry.concat(t.entry)),e}))},A.prototype.referenceToAbsoluteUrl=function(e,t){var r=l.parse(e.reference);if(r.hash&&!r.protocol)return e.reference;var n=this.getContextBaseUrl(t);return l.resolve(n+"/",e.reference)},A.prototype.getContextBaseUrl=function(e){var t=this.getUrl();if(e&&e.meta&&e.meta.security){var r=e.meta.security.find(function(e){return e.system===A.IDENTIFIER_SYSTEMS.TENANCY_SECURITY_SYSTEM});r&&(t=this.getUrl(r.display))}return t},A.EXTENSIONS={TASK_ENABLE_WHEN:"https://fhir-registry.cardihab.com/StructureDefiniton/TaskEnableWhen",EDUCATION_TASK:"https://fhir-registry.cardihab.com/StructureDefiniton/EducationTask",ADHERENCE:"https://fhir-registry.cardihab.com/StructureDefiniton/Adherence",RECURRING_TASK:"https://fhir-registry.cardihab.com/StructureDefiniton/RecurringTask",BASED_ON_GOAL:"https://fhir-registry.cardihab.com/StructureDefiniton/BasedOnGoal",PATIENT_SPECIFIC_REMINDER:"https://fhir-registry.cardihab.com/StructureDefiniton/PatientSpecificReminder",ORGANIZATION_ATTRIBUTES:"https://fhir-registry.cardihab.com/StructureDefiniton/OrganizationAttributes"},A.IDENTIFIER_SYSTEMS={SITECODE:"urn:sitecode",FHIR_IDENTIFIER_TYPE:"http://hl7.org/fhir/identifier-type",SNOMED:"http://snomed.info/sct",GOAL_CATEGORY:"http://hl7.org/fhir/goal-category",TENANCY_SECURITY_SYSTEM:"Tenancy"},A.decorators=[{type:a.Injectable}],A.ctorParameters=function(){return[{type:t.HttpClient},{type:b}]},A);function A(e,t){this.http=e,this.config=t,this.base=this.config.get("fhir"),this.tenancy="baseDstu3",this.refCache=new n.LRUMap(100)}var I=new a.InjectionToken("CONTAINER_DATA"),S=(x.decorators=[{type:a.Component,args:[{selector:"lib-loader",template:'<div>\n  <svg width="200px" height="200px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid"\n    class="lds-heart" style="background: none;">\n    <g transform="translate(50 50)">\n      <path d="M40.7-34.3c-9.8-9.8-25.6-9.8-35.4,0L0-29l-5.3-5.3c-9.8-9.8-25.6-9.8-35.4,0l0,0c-9.8,9.8-9.8,25.6,0,35.4l5.3,5.3L-23,18.7l23,23l23-23L35.4,6.3L40.7,1C50.4-8.8,50.4-24.6,40.7-34.3z"\n        fill="#df1317" transform="scale(0.721575 0.721575)">\n        <animateTransform attributeName="transform" type="scale" calcMode="spline" values="0.68;0.8;0.6000000000000001;0.7200000000000001;0.68;0.6400000000000001"\n          keyTimes="0;0.05;0.39;0.45;0.6;1" dur="1.5s" keySplines="0.215 0.61,0.355 1;0.215 0.61,0.355 1;0.215 0.61,0.355 1;0.215 0.61,0.355 1;0.215 0.61,0.355 1"\n          begin="0s" repeatCount="indefinite"></animateTransform>\n      </path>\n    </g>\n  </svg>\n  <h2 class="loading-message" *ngIf="message">{{ message }}</h2>\n</div>\n',styles:[".loading-message{text-align:center;margin-top:20px;background:#dedede;border-radius:20px}"]}]}],x.ctorParameters=function(){return[{type:undefined,decorators:[{type:a.Optional},{type:a.Inject,args:[I]}]}]},x);function x(e){this.componentData=e,this.message=this.componentData&&this.componentData.message?this.componentData.message:""}var D=(w.prototype.start=function(e){void 0===e&&(e=""),this.overlayRef=this.overlay.create(this.overlayConfig);var t=new s.ComponentPortal(S,null,this.createInjector({message:e}));this.overlayRef.attach(t)},w.prototype.stop=function(){this.overlayRef.dispose()},w.prototype.createInjector=function(e){var t=new WeakMap;return t.set(I,e),new s.PortalInjector(this.injector,t)},w.decorators=[{type:a.Injectable}],w.ctorParameters=function(){return[{type:o.Overlay},{type:a.Injector}]},w);function w(e,t){this.overlay=e,this.injector=t,this.overlayConfig=new o.OverlayConfig,this.overlayConfig.positionStrategy=this.overlay.position().global().centerHorizontally().centerVertically(),this.overlayConfig.hasBackdrop=!0}var N=(j.decorators=[{type:a.NgModule,args:[{declarations:[v,d,f,g,S],imports:[c.CommonModule],exports:[v,d],providers:[E,b,D]}]}],j);function j(){}e.AngularFhirModule=N,e.AgePipe=f,e.FhirCodingPipe=v,e.FhirUsualNamePipe=d,e.ObservationValuePipe=g,e.FhirService=E,e.RegionalConfigService=b,e.LoaderService=D,e.CONTAINER_DATA=I,e.LoaderComponent=S,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=angular-fhir.umd.min.js.map