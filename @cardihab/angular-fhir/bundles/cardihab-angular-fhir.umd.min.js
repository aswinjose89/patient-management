!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("moment"),require("rxjs"),require("@angular/common/http"),require("rxjs/operators"),require("url"),require("@angular/cdk/overlay"),require("@angular/cdk/portal"),require("@angular/common")):"function"==typeof define&&define.amd?define("@cardihab/angular-fhir",["exports","@angular/core","moment","rxjs","@angular/common/http","rxjs/operators","url","@angular/cdk/overlay","@angular/cdk/portal","@angular/common"],t):t(((e=e||self).cardihab=e.cardihab||{},e.cardihab["angular-fhir"]={}),e.ng.core,e.moment,e.rxjs,e.ng.common.http,e.rxjs.operators,e.url,e.ng.cdk.overlay,e.ng.cdk.portal,e.ng.common)}(this,(function(e,t,n,r,o,i,a,u,s,l){"use strict";n=n&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n;function c(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{s(r.next(e))}catch(e){i(e)}}function u(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,u)}s((r=r.apply(e,t||[])).next())}))}function f(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}}function p(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function d(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a}var h=function(){function e(){}return e.prototype.transform=function(e,t){if(e&&n(e).isValid())return n().diff(e,"years")},e.ɵfac=function(t){return new(t||e)},e.ɵpipe=t.ɵɵdefinePipe({name:"ageInYears",type:e,pure:!0}),e}(),v=function(){function e(){}return e.prototype.transform=function(e,t){return e&&e.code&&e.code.coding&&e.code.coding.length>0?e.code.coding[0].display:""},e.ɵfac=function(t){return new(t||e)},e.ɵpipe=t.ɵɵdefinePipe({name:"fhirCoding",type:e,pure:!0}),e}();function y(e){var t;return e.valueString?e.valueString:e.valueReference?e.valueReference:e.valueCoding?e.valueCoding:e.valueUri?e.valueUri:e.valueBoolean?e.valueBoolean:e.valueAddress?e.valueAddress:e.valueAge?e.valueAge:e.valueAnnotation?e.valueAnnotation:e.valueAttachment?e.valueAttachment:e.valueBase64Binary?e.valueBase64Binary:e.valueCode?e.valueCode:e.valueCodeableConcept?e.valueCodeableConcept:e.valueContactPoint?e.valueContactPoint:e.valueCount?e.valueCount:e.valueDate?e.valueDate:e.valueDecimal?e.valueDecimal:e.valueDuration?e.valueDuration:e.valueHumanName?e.valueHumanName:e.valueId?e.valueId:e.valueDateTime?e.valueDateTime:e.valueDistance?e.valueDistance:e.valueInteger?e.valueInteger:e.valueQuantity?e.valueQuantity.value+" "+(t=e.valueQuantity.unit,1!==e.valueQuantity.value&&"serving"===t?t+"s":t):""}function m(e,t){if(void 0===t&&(t={noTitle:!1,capitaliseLastName:!1,firstNameFirst:!1}),e&&e.length>0){var n=e.reduce((function(e,t,n,r){return"usual"===t.use?t:e?"official"===t.use?t:e:t}));if(n.text)return n.text;var r=(t.capitaliseLastName?n.family.toUpperCase():n.family)||"",o=(n.prefix||[]).length>0?" ("+(n.prefix||[]).join(" ")+")":"";return t.firstNameFirst?(t.noTitle?"":o)+" "+(n.given||[])[0]+" "+r:r+", "+(n.given||[])[0]+(t.noTitle?"":o)}return"<No Name>"}var g=function(){function e(){}return e.prototype.transform=function(e,t){return m(e,t)},e.ɵfac=function(t){return new(t||e)},e.ɵpipe=t.ɵɵdefinePipe({name:"fhirUsualName",type:e,pure:!0}),e}(),b=function(){function e(){}return e.prototype.transform=function(e,t){var n=(e.component||[]).length>1;return(e.component||[]).map((function(e){return(n?(new v).transform(e)+":":"")+y(e)})).join(", ")},e.ɵfac=function(t){return new(t||e)},e.ɵpipe=t.ɵɵdefinePipe({name:"observationValue",type:e,pure:!0}),e}();var w=function(){function e(){}return e.prototype.load=function(e){return c(this,void 0,void 0,(function(){var t,n=this;return f(this,(function(r){switch(r.label){case 0:return[4,fetch("./assets/environment-"+e+".json")];case 1:return[4,r.sent().json()];case 2:return t=r.sent(),Object.keys(t).forEach((function(e){n.hasOwnProperty(e)||Object.defineProperty(n,e,{get:function(){return t[e]}})})),this.region=e,[2,t]}}))}))},e.prototype.get=function(e){return this[e]},e.ɵfac=function(t){return new(t||e)},e.ɵprov=t.ɵɵdefineInjectable({token:e,factory:e.ɵfac}),e}(),C=Symbol("newer"),S=Symbol("older"),E=function(e,t){this.key=e,this.value=t},T=function(){function e(e,t){this.limit=e,this.size=0,this._keymap=new Map,"number"!=typeof e&&(t=e,e=0),t&&(this.assign(t),e<1&&(this.limit=this.size))}return e.prototype._markEntryAsUsed=function(e){e!==this.newest&&(e[C]&&(e===this.oldest&&(this.oldest=e[C]),e[C][S]=e[S]),e[S]&&(e[S][C]=e[C]),e[C]=void 0,e[S]=this.newest,this.newest&&(this.newest[C]=e),this.newest=e)},e.prototype.assign=function(e){var t,n=this.limit||Number.MAX_VALUE;this._keymap.clear();for(var r=e[Symbol.iterator](),o=r.next();!o.done;o=r.next()){var i=new E(o.value[0],o.value[1]);if(this._keymap.set(i.key,i),t?(t[C]=i,i[S]=t):this.oldest=i,t=i,0==n--)throw new Error("overflow")}this.newest=t,this.size=this._keymap.size},e.prototype.get=function(e){var t=this._keymap.get(e);if(t)return this._markEntryAsUsed(t),t.value},e.prototype.set=function(e,t){var n=this._keymap.get(e);return n?(n.value=t,this._markEntryAsUsed(n),this):(this._keymap.set(e,n=new E(e,t)),this.newest?(this.newest[C]=n,n[S]=this.newest):this.oldest=n,this.newest=n,++this.size,this.size>this.limit&&this.shift(),this)},e.prototype.shift=function(){var e=this.oldest;if(e)return this.oldest[C]?(this.oldest=this.oldest[C],this.oldest[S]=void 0):(this.oldest=void 0,this.newest=void 0),e[C]=e[S]=void 0,this._keymap.delete(e.key),--this.size,[e.key,e.value]},e}(),A=function(){function e(e,t){this.http=e,this.config=t,this.base=this.config.get("fhir"),this.tenancy="baseDstu3",this.refCache=new T(100)}return e.hasCoding=function(e,t){var n,r;if(e&&e.coding&&t){var o=function(e){if(e.code&&null!=t.find((function(t){return t.system===e.system&&t.code===e.code})))return{value:!0}};try{for(var i=p(e.coding),a=i.next();!a.done;a=i.next()){var u=o(a.value);if("object"==typeof u)return u.value}}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}}return!1},e.referenceToId=function(e){var t=d((e||{reference:""}).reference.split("/"),2);return{resourceType:t[0],id:t[1]}},e.flattenExtension=function(t){var n={};return t.extension?(t.extension.forEach((function(t){n[t.url]=e.flattenExtension(t)})),n):t.valueString?t.valueString:t.valueReference?t.valueReference:t.valueCoding?t.valueCoding:t.valueUri?t.valueUri:t.valueBoolean?t.valueBoolean:t.valueAddress?t.valueAddress:t.valueAge?t.valueAge:t.valueAnnotation?t.valueAnnotation:t.valueAttachment?t.valueAttachment:t.valueBase64Binary?t.valueBase64Binary:t.valueCode?t.valueCode:t.valueCodeableConcept?t.valueCodeableConcept:t.valueContactPoint?t.valueContactPoint:t.valueCount?t.valueCount:t.valueDate?t.valueDate:t.valueDecimal?t.valueDecimal:t.valueDuration?t.valueDuration:t.valueHumanName?t.valueHumanName:t.valueId?t.valueId:t.valueDateTime?t.valueDateTime:t.valueDistance?t.valueDistance:t.valueInteger?t.valueInteger:null},e.prototype.getUrl=function(e){return this.base+"/"+(e||this.tenancy)},e.prototype.setUrl=function(e){this.base=e},e.prototype.options=function(){return new o.HttpHeaders({Accept:"application/json"})},e.prototype.nextPage=function(e){if(e){var t=(e.link||[]).find((function(e){return"next"===e.relation}));if(t)return this.http.get(t.url)}return r.throwError(new Error("No next link to follow"))},e.prototype.reference=function(e,t){if(e&&e.reference){var n=this.referenceToAbsoluteUrl(e,t),o=this.refCache.get(n);return n.startsWith("#")?r.throwError(new Error("Don't yet support contained references")):(o||(o=new r.ReplaySubject(1),this.http.get(n).subscribe(o),this.refCache.set(n,o)),o)}return r.throwError(new Error("Invalid reference"))},e.prototype.get=function(e,t,n){return"new"===t?r.of(null):this.http.get(this.getUrl(n)+"/"+e+"/"+t)},e.prototype.search=function(e,t,n,o){var u=this;void 0===o&&(o=!1);var s={params:t};n&&n.headers&&(s.headers=n.headers);var l=this.http.get(this.getUrl((n||{}).tenancy)+"/"+e,s);return o?l:l.pipe(i.expand((function(e){var t=((e.link||[]).find((function(e){return"next"===e.relation}))||{}).url;return t?u.http.get(a.format(a.parse(t,!0))):r.of()})),i.reduce((function(e,t){return e.entry&&t.entry&&(e.entry=e.entry.concat(t.entry)),e})))},e.prototype.patch=function(e,t,n){var r={headers:{"content-type":"application/json-patch+json"}};return n&&n.headers&&Object.assign(r.headers,n.headers),this.http.patch(e,t,r)},e.prototype.delete=function(e,t,n){var r={};return n&&n.headers&&(r.headers=n.headers),this.http.delete(this.getUrl((n||{}).tenancy)+"/"+e+"/"+t,r)},e.prototype.save=function(e,t){return"Bundle"===e.resourceType?this.http.post(""+this.getUrl((t||{}).tenancy),e,{headers:{"content-type":"application/fhir+json",Prefer:"return=representation"}}).pipe(i.tap((function(t){(t.entry||[]).forEach((function(t,n){e.entry[n]&&(e.entry[n].resource.id=t.resource.id)}))}))):this.saveAll([e],t).pipe(i.map((function(e){return e.entry[0].resource})))},e.prototype.saveAll=function(e,t){var n=e.map((function(e){return{request:{method:e.id?"PUT":"POST",url:e.id?e.resourceType+"/"+e.id:(e.identifier||[])[0]?"urn:uuid:"+e.identifier[0].value:e.resourceType},resource:e}}));return this.save({resourceType:"Bundle",type:"transaction",entry:n},t)},e.prototype.resolveReferences=function(t,n,o){var u=this;if(void 0===o&&(o=500),!t||!Array.isArray(t)||!t.length)return r.of({});var s=e.referenceToId(t[0]).resourceType,l=t.map((function(t){return e.referenceToId(t).id}));return this.http.post(this.getContextBaseUrl(n)+"/"+s+"/_search","_id="+l.join(",")+"&_count="+o,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).pipe(i.expand((function(e){var t=((e.link||[]).find((function(e){return"next"===e.relation}))||{}).url;return t?u.http.get(a.format(a.parse(t,!0))):r.of()})),i.reduce((function(e,t){return e.entry&&t.entry&&(e.entry=e.entry.concat(t.entry)),e})))},e.prototype.referenceToAbsoluteUrl=function(e,t){var n=a.parse(e.reference);if(n.hash&&!n.protocol)return e.reference;var r=this.getContextBaseUrl(t);return a.resolve(r+"/",e.reference)},e.prototype.getContextBaseUrl=function(t){var n=this.getUrl();if(t&&t.meta&&t.meta.security){var r=t.meta.security.find((function(t){return t.system===e.IDENTIFIER_SYSTEMS.TENANCY_SECURITY_SYSTEM}));r&&(n=this.getUrl(r.display))}return n},e.EXTENSIONS={TASK_ENABLE_WHEN:"https://fhir-registry.cardihab.com/StructureDefiniton/TaskEnableWhen",EDUCATION_TASK:"https://fhir-registry.cardihab.com/StructureDefiniton/EducationTask",ADHERENCE:"https://fhir-registry.cardihab.com/StructureDefiniton/Adherence",RECURRING_TASK:"https://fhir-registry.cardihab.com/StructureDefiniton/RecurringTask",BASED_ON_GOAL:"https://fhir-registry.cardihab.com/StructureDefiniton/BasedOnGoal",PATIENT_SPECIFIC_REMINDER:"https://fhir-registry.cardihab.com/StructureDefiniton/PatientSpecificReminder",ORGANIZATION_ATTRIBUTES:"https://fhir-registry.cardihab.com/StructureDefiniton/OrganizationAttributes"},e.IDENTIFIER_SYSTEMS={SITECODE:"urn:sitecode",FHIR_IDENTIFIER_TYPE:"http://hl7.org/fhir/identifier-type",SNOMED:"http://snomed.info/sct",GOAL_CATEGORY:"http://hl7.org/fhir/goal-category",TENANCY_SECURITY_SYSTEM:"Tenancy"},e.ɵfac=function(n){return new(n||e)(t.ɵɵinject(o.HttpClient),t.ɵɵinject(w))},e.ɵprov=t.ɵɵdefineInjectable({token:e,factory:e.ɵfac}),e}();function x(e,n){if(1&e&&(t.ɵɵnamespaceSVG(),t.ɵɵnamespaceHTML(),t.ɵɵelementStart(0,"h2",5),t.ɵɵtext(1),t.ɵɵelementEnd()),2&e){var r=t.ɵɵnextContext();t.ɵɵadvance(1),t.ɵɵtextInterpolate(r.message)}}var I=new t.InjectionToken("CONTAINER_DATA"),D=function(){function e(e){this.componentData=e,this.message=this.componentData&&this.componentData.message?this.componentData.message:""}return e.ɵfac=function(n){return new(n||e)(t.ɵɵdirectiveInject(I,8))},e.ɵcmp=t.ɵɵdefineComponent({type:e,selectors:[["lib-loader"]],decls:6,vars:1,consts:[["width","200px","height","200px","xmlns","http://www.w3.org/2000/svg","viewBox","0 0 100 100","preserveAspectRatio","xMidYMid",1,"lds-heart",2,"background","none"],["transform","translate(50 50)"],["d","M40.7-34.3c-9.8-9.8-25.6-9.8-35.4,0L0-29l-5.3-5.3c-9.8-9.8-25.6-9.8-35.4,0l0,0c-9.8,9.8-9.8,25.6,0,35.4l5.3,5.3L-23,18.7l23,23l23-23L35.4,6.3L40.7,1C50.4-8.8,50.4-24.6,40.7-34.3z","fill","#df1317","transform","scale(0.721575 0.721575)"],["attributeName","transform","type","scale","calcMode","spline","values","0.68;0.8;0.6000000000000001;0.7200000000000001;0.68;0.6400000000000001","keyTimes","0;0.05;0.39;0.45;0.6;1","dur","1.5s","keySplines","0.215 0.61,0.355 1;0.215 0.61,0.355 1;0.215 0.61,0.355 1;0.215 0.61,0.355 1;0.215 0.61,0.355 1","begin","0s","repeatCount","indefinite"],["class","loading-message",4,"ngIf"],[1,"loading-message"]],template:function(e,n){1&e&&(t.ɵɵelementStart(0,"div"),t.ɵɵnamespaceSVG(),t.ɵɵelementStart(1,"svg",0),t.ɵɵelementStart(2,"g",1),t.ɵɵelementStart(3,"path",2),t.ɵɵelement(4,"animateTransform",3),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵtemplate(5,x,2,1,"h2",4),t.ɵɵelementEnd()),2&e&&(t.ɵɵadvance(5),t.ɵɵproperty("ngIf",n.message))},directives:[l.NgIf],styles:[".loading-message[_ngcontent-%COMP%]{text-align:center;margin-top:20px;background:#dedede;border-radius:20px}"]}),e}(),j=function(){function e(e,t){this.overlay=e,this.injector=t,this.overlayConfig=new u.OverlayConfig,this.overlayConfig.positionStrategy=this.overlay.position().global().centerHorizontally().centerVertically(),this.overlayConfig.hasBackdrop=!0}return e.prototype.start=function(e){void 0===e&&(e=""),this.overlayRef=this.overlay.create(this.overlayConfig);var t=new s.ComponentPortal(D,null,this.createInjector({message:e}));this.overlayRef.attach(t)},e.prototype.stop=function(){this.overlayRef.dispose()},e.prototype.createInjector=function(e){var t=new WeakMap;return t.set(I,e),new s.PortalInjector(this.injector,t)},e.ɵfac=function(n){return new(n||e)(t.ɵɵinject(u.Overlay),t.ɵɵinject(t.Injector))},e.ɵprov=t.ɵɵdefineInjectable({token:e,factory:e.ɵfac}),e}(),k=function(){function e(){}return e.ɵmod=t.ɵɵdefineNgModule({type:e}),e.ɵinj=t.ɵɵdefineInjector({factory:function(t){return new(t||e)},providers:[A,w,j],imports:[[l.CommonModule]]}),e}();("undefined"==typeof ngJitMode||ngJitMode)&&t.ɵɵsetNgModuleScope(k,{declarations:[v,g,h,b,D],imports:[l.CommonModule],exports:[v,g,h,b,D]}),e.AgePipe=h,e.AngularFhirModule=k,e.FhirCodingPipe=v,e.FhirService=A,e.FhirUsualNamePipe=g,e.LoaderComponent=D,e.LoaderService=j,e.ObservationValuePipe=b,e.RegionalConfigService=w,e.formatAddress=function(e,t){if(!(e&&e.address&&Array.isArray(e.address)&&e.address.length))return"";t=t||[];var n=e.address.find((function(e){return t.indexOf(e.type)>-1}));n=n||e.address[0];var r=e.telecom.find((function(e){return"phone"===e.system}));return[e.name+",",n.line.join(" ")+",",n.city,n.state,n.postalCode,r].join(" ")},e.formatDOB=function(e,t){void 0===t&&(t=!1);var r=n(e),o=" ("+n().diff(r,"years")+" ys)";return""+r.format("DD-MMM-YYYY")+(t?o:"")},e.formatFhirName=m,e.observableToReplaySubject=function(e,t){var n=new r.ReplaySubject(t||1);return e.subscribe(n),n},e.toValueString=y,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=cardihab-angular-fhir.umd.min.js.map